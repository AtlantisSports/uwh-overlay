#!/usr/bin/env python

from uwh.gamemanager import GameManager, Penalty, TeamColor
from uwh.xbee_comms import XBeeClient, XBeeConfigParser, xbee_port, xbee_baud
from overlay.ui import Overlay, MaskKind
import argparse

parser = argparse.ArgumentParser(description='Timeshark Video Overlay')
parser.add_argument('--luma', help='Display the overlay\'s greyscale mask',
                    action='store_const', const=MaskKind.LUMA, dest='mask')
parser.add_argument('--chroma', help='Perform masking via chroma keying',
                    action='store_const', const=MaskKind.CHROMA, dest='mask')
parser.add_argument('--version', help='Version of the display',type=str,
                    choices=Overlay.versions())
args = parser.parse_args()

mgr = GameManager()
mgr.setPassive()
mgr.setBlackScore(10)
mgr.setWhiteScore(11)
mgr.setGameClock(12 * 60 + 34)
mgr.setGameStateFirstHalf()
#mgr.setTimeoutStateRef()
mgr.setGid(1)
mgr.setTid(15)

mgr.addPenalty(Penalty(5, TeamColor.white, 5 * 60))
mgr.addPenalty(Penalty(2, TeamColor.white, 2 * 60))
mgr.addPenalty(Penalty(1, TeamColor.black, 1 * 60))

cfg = XBeeConfigParser()
cfg.read('timeshark.cfg')

if cfg.getboolean('hardware', 'has_xbee'):
    xbee = XBeeServer(mgr, xbee_port(cfg), xbee_baud(cfg))
    xbee.listen_thread()

ov = Overlay(mgr, args.mask, args.version)
ov.mainloop()

